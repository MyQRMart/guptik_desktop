

## üõ°Ô∏è Project Guptik: Overview

**Guptik** is a secure, decentralized personal server ecosystem. It allows users to own their data (Vault, Messaging, AI) locally on their desktop while maintaining a seamless, encrypted sync with their mobile devices via a Cloudflare-tunneled private link.

### üß© Core Components

* **The Vault**: A dynamic file management system. It provides visibility for media (images/videos) while keeping documents secure. It supports local favorites and password-protected sharing links.
* **Trust_Me**: A private, local-first messaging system integrated into the stack.
* **Home Control**: Automation and server management.
* **Local AI (Ollama)**: A locally hosted LLM agent accessible via the internal API gateway.
* **Admin Orchestrator**: A central Supabase instance that manages device registration (`desktop_devices` table) and provisions Cloudflare Tunnel tokens via Edge Functions.

---

## üöÄ Desktop Installation Flow

We have designed the installation to be **fully automated** and **dynamic**, avoiding hardcoded paths so it works for any user.

| Step | Action | Outcome |
| --- | --- | --- |
| **1. QR Login** | User scans a QR code on the desktop app using the Guptik Mobile app. | Authenticates the user and generates a unique `deviceId` for the desktop. |
| **2. Storage Selection** | User picks a local folder (e.g., `/home/user/MyVault`). | Sets the dynamic `vault_path` used for all Docker volumes and configs. |
| **3. Tunnel Provisioning** | App calls the `user-cf-tunnel` Edge Function on the Admin Supabase. | Generates a Cloudflare Tunnel and unique URL: `{reverseduid}.myqrmart.com`. |
| **4. Auto-Config** | App automatically writes `.env`, `kong.yml`, and `docker-compose.yml` to the selected folder. | No manual file editing is required by the user. |
| **5. Stack Launch** | App triggers `docker-compose up -d`. | Starts Postgres, Kong (Gateway), Cloudflared (Tunnel), and Ollama (AI). |

---

## üßπ Data Security & Wipe Logic

We implemented a "Total Wipe" policy for privacy. The **`linux-uninstall.sh`** script performs the following:

1. **Stop & Purge**: Runs `docker-compose down -v`. The `-v` flag is critical as it deletes the actual database volumes on the disk.
2. **Delete Files**: Recursively deletes the user-selected Vault directory and all encrypted data.
3. **Clear Config**: Removes the `$HOME/.config/guptik_desktop` folder to wipe all login sessions and preferences.

---

## üõ†Ô∏è Technical Debt for the Next Agent

* **Supabase Service**: Ensure the `client` getter is public to allow the UI to talk to the Edge Functions directly.
* **Vault Model**: The `isFavorite` field in `VaultFile` must be non-final to allow the toggle UI to update state.
* **Asset Bundling**: Ensure `kong.yml` and `docker-compose.yml` templates are added to `pubspec.yaml` so the `DockerService` can deploy them to the user's path.

---

**Would you like me to generate a single, final "Setup Checklist" document that you can copy-paste into your new chat?**