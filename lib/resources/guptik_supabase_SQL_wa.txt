TABLE public.conversations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  ai_agent_id uuid,
  phone_number character varying NOT NULL,
  contact_name character varying,
  contact_email text,
  contact_notes text,
  last_message text,
  last_message_time text NOT NULL,
  is_unread boolean DEFAULT true,
  is_archived boolean DEFAULT false,
  created_at text NOT NULL DEFAULT (now() AT TIME ZONE 'ist'::text),
  updated_at timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
  CONSTRAINT conversations_pkey PRIMARY KEY (id),
  CONSTRAINT conversations_ai_agent_id_fkey FOREIGN KEY (ai_agent_id) REFERENCES public.ai_agents(id),
  CONSTRAINT conversations_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
TABLE public.desktop_devices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  device_id text NOT NULL UNIQUE,
  device_name text,
  device_model text,
  vault_path text,
  services_path text,
  is_verified boolean DEFAULT false,
  installation_status text DEFAULT 'pending'::text,
  last_active_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  cf_tunnel_id text,
  cf_tunnel_token text,
  public_url text,
  CONSTRAINT desktop_devices_pkey PRIMARY KEY (id),
  CONSTRAINT desktop_devices_user FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
TABLE public.message_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  name character varying NOT NULL CHECK (length(TRIM(BOTH FROM name)) > 0),
  category character varying NOT NULL DEFAULT 'General'::character varying CHECK (category::text = ANY (ARRAY['Marketing'::character varying::text, 'Utility'::character varying::text, 'Authentication'::character varying::text, 'General'::character varying::text, 'Greeting'::character varying::text, 'Business'::character varying::text, 'Support'::character varying::text, 'Promotion'::character varying::text, 'Reminder'::character varying::text])),
  language character varying NOT NULL DEFAULT 'English'::character varying,
  type character varying NOT NULL DEFAULT 'Custom'::character varying,
  status character varying NOT NULL DEFAULT 'DRAFT'::character varying CHECK (status::text = ANY (ARRAY['DRAFT'::character varying::text, 'PENDING'::character varying::text, 'APPROVED'::character varying::text, 'REJECTED'::character varying::text])),
  header_type character varying DEFAULT 'None'::character varying CHECK (header_type::text = ANY (ARRAY['None'::character varying::text, 'Text'::character varying::text, 'Image'::character varying::text, 'Video'::character varying::text, 'Document'::character varying::text])),
  header text,
  message text NOT NULL CHECK (length(TRIM(BOTH FROM message)) > 0),
  footer text,
  usage_count integer DEFAULT 0,
  is_favorite boolean DEFAULT false,
  last_used_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  buttons jsonb,
  CONSTRAINT message_templates_pkey PRIMARY KEY (id),
  CONSTRAINT message_templates_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
TABLE public.messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  conversation_id uuid NOT NULL,
  message_id character varying NOT NULL UNIQUE,
  content text NOT NULL,
  message_type character varying NOT NULL DEFAULT 'text'::character varying CHECK (message_type::text = ANY (ARRAY['text'::character varying::text, 'image'::character varying::text, 'video'::character varying::text, 'audio'::character varying::text, 'document'::character varying::text, 'location'::character varying::text, 'contacts'::character varying::text, 'sticker'::character varying::text, 'reaction'::character varying::text])),
  direction character varying NOT NULL CHECK (direction::text = ANY (ARRAY['incoming'::character varying::text, 'outgoing'::character varying::text, 'ai_outgoing'::character varying::text])),
  status character varying,
  timestamp text NOT NULL,
  status_timestamp text,
  template_id uuid,
  media_info jsonb,
  raw_data jsonb,
  created_at text NOT NULL,
  updated_at text NOT NULL,
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.message_templates(id),
  CONSTRAINT messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.conversations(id)
);
TABLE public.scheduled_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  conversation_id uuid NOT NULL,
  template_id uuid,
  message_text text,
  scheduled_for timestamp with time zone NOT NULL,
  sent_at timestamp with time zone,
  status character varying NOT NULL DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::text, 'sent'::text, 'failed'::text, 'cancelled'::text])),
  retry_count integer DEFAULT 0,
  error_message text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scheduled_messages_pkey PRIMARY KEY (id),
  CONSTRAINT scheduled_messages_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.message_templates(id),
  CONSTRAINT scheduled_messages_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT scheduled_messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.conversations(id)
);
TABLE public.user_api_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  whatsapp_access_token text,
  meta_wa_phone_number_id text,
  meta_business_account_id text,
  mobile_number text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  hc_role text DEFAULT 'user'::text,
  instagram_access_token text,
  instagram_account_id text,
  facebook_user_access_token text,
  facebook_account_id text,
  facebook_page_access_token text,
  CONSTRAINT user_api_settings_pkey PRIMARY KEY (id),
  CONSTRAINT user_api_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
TABLE public.whatsapp_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  category text NOT NULL,
  language text NOT NULL,
  body text NOT NULL,
  footer text,
  variables jsonb,
  buttons jsonb,
  status text NOT NULL DEFAULT 'pending'::text,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone,
  header_media_url text,
  header_text text,
  sample_content jsonb,
  meta_business_account_id text,
  whatsapp_phone_number_id text,
  whatsapp_numeric_id text,
  header_media_id text,
  header_media_type text,
  CONSTRAINT whatsapp_templates_pkey PRIMARY KEY (id)
);